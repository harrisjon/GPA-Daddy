<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Minimum GPA Calculator - Trim II</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; font-family: system-ui, sans-serif; }

    body {
      margin: 0; padding: 0; background: #f3f4f6;
      display: flex; justify-content: center; align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      background: #fff; margin: 1.5rem 1rem; padding: 1.5rem;
      max-width: 900px; width: 100%; border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.06);
    }

    h1 { text-align: center; font-size: 1.7rem; margin-top: 0; color:#111827; }

    .description {
      text-align: center; color: #6b7280; font-size: 0.9rem;
      margin-bottom: 1rem; line-height: 1.4;
    }

    .table-wrapper { width: 100%; overflow-x: auto; margin-top: 0.5rem; }

    table {
      width: 100%; border-collapse: collapse; min-width: 550px;
    }

    th, td {
      padding: 0.6rem; font-size: 0.9rem; border-bottom: 1px solid #f3f4f6;
      text-align:left;
    }

    th {
      background: #f9fafb; font-weight: 600; white-space: nowrap; color:#374151;
    }

    input[type="number"] {
      width: 100%; padding: 0.4rem; border-radius: 0.5rem;
      border: 1px solid #d1d5db; font-size: 0.9rem; outline:none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    input[type="number"]:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.3);
    }

    .btn {
      border: none; border-radius: 999px; padding: 0.55rem 1.2rem; cursor: pointer;
      font-size: 0.9rem; transition: 0.15s; white-space: nowrap;
      display:inline-flex; align-items:center; justify-content:center; gap:0.25rem;
    }

    .btn-primary { background: #4f46e5; color: white; }
    .btn-primary:hover { background: #4338ca; }

    .btn-secondary { background: #e5e7eb; color:#111827; }
    .btn-secondary:hover { background: #d1d5db; }

    .btn-danger { background: #dc2626; color:#fff; }
    .btn-danger:hover { background: #b91c1c; }

    .actions {
      display: flex; justify-content: flex-end; gap: 0.75rem;
      flex-wrap: wrap; margin-top: 1rem;
    }

    .result-card {
      margin-top: 1rem; padding: 1rem; background: #f9fafb;
      border: 1px solid #e5e7eb; border-radius: 0.9rem;
      display: flex; justify-content: space-between; flex-wrap: wrap; gap:0.5rem;
    }

    .result-label { font-size:0.95rem; color:#4b5563; }

    .result-value {
      font-weight: 700; font-size: 1.3rem; color: #16a34a;
      margin-left:0.25rem;
    }

    .grade-badge {
      background: #e0f2fe; padding: 0.25rem 0.6rem; border-radius: 999px;
      font-weight: 600; font-size: 0.85rem; display: inline-block; text-align: center;
      min-width:2.4rem;
    }

    #errorBox {
      margin-top: 0.5rem; font-size:0.85rem; color:#b91c1c;
    }

    @media (max-width: 640px) {
      .container { margin: 1rem 0.5rem; padding: 1.1rem; }
      h1 { font-size: 1.4rem; }
      .description { font-size: 0.85rem; }
      .btn { width: 100%; }
      .actions { flex-direction: column-reverse; align-items: stretch; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Minimum GPA Calculator - Trim II</h1>

    <p class="description">
      Enter <strong>ICA marks only</strong>. Pass marks will be added automatically where applicable
      to calculate your <strong>minimum GPA</strong>.<br/>
      Then you can explore <strong>maximum GPA</strong> using the “If I score” column.
    </p>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Subject</th>
            <th>ICA Marks</th>
            <th id="marksHeader">
              Adjusted Marks<br>
              <span style="font-weight:400;font-size:0.8rem;">(ICA + Pass Marks)</span>
            </th>
            <th id="totalHeader" style="display:none;">Total Marks</th>
            <th>Grade</th>
          </tr>
        </thead>
        <tbody id="coursesBody"></tbody>
      </table>
    </div>

    <div class="actions">
      <button class="btn btn-secondary" onclick="clearFields()">Reset</button>
      <button id="minBtn" class="btn btn-primary" onclick="handleMinClick()">
        Calculate your minimum GPA
      </button>
      <button id="maxBtn" class="btn btn-danger" style="display:none;" onclick="handleMaxClick()">
        Calculate your max GPA
      </button>
      <button id="maxClearBtn" class="btn btn-secondary" style="display:none;" onclick="clearMaxFields()">
        Clear fields
      </button>
    </div>

    <div class="result-card">
      <span class="result-label">
        <span id="gpaLabel">Your Minimum GPA:</span>
        <span id="cgpaValue" class="result-value">–</span>
      </span>
      <span class="result-label">
        Total Credits:
        <strong id="totalCredits">0</strong>
      </span>
    </div>

    <div id="errorBox"></div>
  </div>

  <script>
    const subjects = [
      { name: "ICLA", credits: 1.5, icaMax: 30, maxMarks: 50,  passMarks: 8  },
      { name: "Macro", credits: 3,  icaMax: 60, maxMarks: 100, passMarks: 16 },
      { name: "MADM", credits: 3,   icaMax: 60, maxMarks: 100, passMarks: 16 },
      { name: "MC",   credits: 1.5, icaMax: 50, maxMarks: 50,  passMarks: 0  },
      { name: "OB2",  credits: 3,   icaMax: 100,maxMarks: 100, passMarks: 0  },
      { name: "SWD",  credits: 1.5, icaMax: 50, maxMarks: 50,  passMarks: 0  },
      { name: "VRCM", credits: 1.5, icaMax: 30, maxMarks: 50,  passMarks: 8  },
      { name: "MOBD", credits: 3,   icaMax: 60, maxMarks: 100, passMarks: 16 },
      { name: "MM2",  credits: 3,   icaMax: 60, maxMarks: 100, passMarks: 16 }  // NEW
    ];

    const frozenSubjects = ["MC", "OB2", "SWD"]; // fixed in max mode

    let currentMode = "min";    // "min" or "max"
    let minCalculated = false;  // to ensure max GPA uses frozen min grades

    function createRows() {
      const tbody = document.getElementById("coursesBody");
      subjects.forEach(subj => {
        const row = document.createElement("tr");
        row.dataset.credits = subj.credits;
        row.dataset.maxMarks = subj.maxMarks;
        row.dataset.icaMax = subj.icaMax;
        row.dataset.passMarks = subj.passMarks;

        let ifMax = 40;
        if (subj.name === "ICLA" || subj.name === "VRCM") ifMax = 20;
        if (frozenSubjects.includes(subj.name)) ifMax = 0;
        row.dataset.ifScoreMax = ifMax;

        row.innerHTML = `
          <td>${subj.name}</td>
          <td>
            <input type="number"
                   class="icaMarks"
                   min="0"
                   max="${subj.icaMax}"
                   placeholder="0-${subj.icaMax}">
          </td>
          <td>
            <span class="adjustedMarks">–</span>
            <input type="number"
                   class="ifScoreMarks"
                   style="display:none;"
                   min="0"
                   max="${ifMax}"
                   placeholder="0-${ifMax}">
          </td>
          <td class="totalMarksCell" style="display:none;">
            <span class="totalMarks">–</span>
          </td>
          <td><span class="grade grade-badge">–</span></td>
        `;
        tbody.appendChild(row);

        // Auto-calc on typing ICA (min mode)
        const icaInput = row.querySelector(".icaMarks");
        icaInput.addEventListener("input", () => {
          if (currentMode === "min") {
            calculateMinGPA();
          }
        });

        // Auto-calc on typing "If I score" (max mode)
        const ifScoreInput = row.querySelector(".ifScoreMarks");
        ifScoreInput.addEventListener("input", () => {
          if (currentMode === "max") {
            calculateMaxGPA();
          }
        });
      });
    }

    function getGradePoint(marks, maxMarks) {
      // 50-mark scale
      if (maxMarks === 50) {
        if (marks >= 45) return 10;
        if (marks >= 40) return 9;
        if (marks >= 35) return 8;
        if (marks >= 30) return 7;
        if (marks >= 27.5) return 6;
        if (marks >= 25) return 5;
        if (marks >= 20) return 4;
        return 0;
      }

      // 100-mark scale
      if (marks >= 90) return 10;
      if (marks >= 80) return 9;
      if (marks >= 70) return 8;
      if (marks >= 60) return 7;
      if (marks >= 50) return 6;
      if (marks >= 40) return 5;
      if (marks >= 30) return 4;
      return 0;
    }

    function gradeFromPoint(gp) {
      if (gp === 10) return "O";
      if (gp === 9)  return "A+";
      if (gp === 8)  return "A";
      if (gp === 7)  return "B+";
      if (gp === 6)  return "B";
      if (gp === 5)  return "C";
      if (gp === 4)  return "P";
      return "F";
    }

    // ----- Modes -----
    function switchToMinMode() {
      currentMode = "min";
      document.getElementById("marksHeader").innerHTML =
        `Adjusted Marks<br><span style="font-weight:400;font-size:0.8rem;">(ICA + Pass Marks)</span>`;
      document.getElementById("totalHeader").style.display = "none";
      document.getElementById("gpaLabel").textContent = "Your Minimum GPA:";
      document.getElementById("maxClearBtn").style.display = "none";

      document.querySelectorAll("#coursesBody tr").forEach(row => {
        const icaInput = row.querySelector(".icaMarks");
        const ifScoreInput = row.querySelector(".ifScoreMarks");
        const adjustedSpan = row.querySelector(".adjustedMarks");
        const totalCell = row.querySelector(".totalMarksCell");

        icaInput.disabled = false;
        adjustedSpan.style.display = "inline";
        ifScoreInput.style.display = "none";
        totalCell.style.display = "none";
      });
    }

    function switchToMaxMode() {
      currentMode = "max";
      document.getElementById("marksHeader").textContent = "If I score";
      document.getElementById("totalHeader").style.display = "table-cell";
      document.getElementById("gpaLabel").textContent = "Your Maximum GPA:";
      document.getElementById("maxClearBtn").style.display = "inline-flex";

      document.querySelectorAll("#coursesBody tr").forEach(row => {
        const subjName = row.cells[0].textContent.trim();
        const icaInput = row.querySelector(".icaMarks");
        const ifScoreInput = row.querySelector(".ifScoreMarks");
        const adjustedSpan = row.querySelector(".adjustedMarks");
        const totalCell = row.querySelector(".totalMarksCell");
        const gradeSpan = row.querySelector(".grade");
        const totalMarksSpan = row.querySelector(".totalMarks");

        icaInput.disabled = true;
        adjustedSpan.style.display = "none";
        ifScoreInput.style.display = "inline";
        totalCell.style.display = "table-cell";

        totalMarksSpan.textContent = "–";
        if (!frozenSubjects.includes(subjName)) {
          gradeSpan.textContent = "–";
        }

        if (frozenSubjects.includes(subjName)) {
          ifScoreInput.disabled = true;
          ifScoreInput.placeholder = "N/A";
        } else {
          ifScoreInput.disabled = false;
          const limit = row.dataset.ifScoreMax;
          ifScoreInput.placeholder = `0-${limit}`;
        }
      });
    }

    // ----- Minimum GPA -----
    function calculateMinGPA() {
      const rows = document.querySelectorAll("#coursesBody tr");
      let totalCredits = 0, totalWeightedPoints = 0;
      let error = "";

      rows.forEach(row => {
        const subjName = row.cells[0].textContent.trim();
        const credits = parseFloat(row.dataset.credits);
        const maxMarks = parseFloat(row.dataset.maxMarks);
        const icaMax = parseFloat(row.dataset.icaMax);
        const passMarks = parseFloat(row.dataset.passMarks);

        const icaVal = row.querySelector(".icaMarks").value;
        const ica = parseFloat(icaVal);

        if (icaVal === "") { // allow partial typing
          error = "";
          return;
        }

        if (isNaN(ica) || ica < 0 || ica > icaMax) {
          error = `ICA marks for ${subjName} must be between 0 and ${icaMax}.`;
          return;
        }

        let adjusted = Math.min(ica + passMarks, maxMarks);
        const gp = getGradePoint(adjusted, maxMarks);

        row.querySelector(".adjustedMarks").textContent = adjusted.toFixed(0);
        row.querySelector(".grade").textContent = gradeFromPoint(gp);
        row.dataset.minGp = gp;
        row.querySelector(".totalMarks").textContent = "–";

        totalCredits += credits;
        totalWeightedPoints += credits * gp;
      });

      const errorBox = document.getElementById("errorBox");
      const cgpaValue = document.getElementById("cgpaValue");
      const totalCreditsSpan = document.getElementById("totalCredits");

      const anyEmpty = Array.from(rows).some(row => {
        return row.querySelector(".icaMarks").value === "";
      });

      if (error) {
        errorBox.textContent = error;
        cgpaValue.textContent = "–";
        totalCreditsSpan.textContent = "0";
        minCalculated = false;
        return;
      }

      if (anyEmpty || totalCredits === 0) {
        errorBox.textContent = "";
        cgpaValue.textContent = "–";
        totalCreditsSpan.textContent = "0";
        minCalculated = false;
        return;
      }

      errorBox.textContent = "";
      cgpaValue.textContent = (totalWeightedPoints / totalCredits).toFixed(2);
      totalCreditsSpan.textContent = totalCredits.toFixed(1);
      minCalculated = true;
    }

    // ----- Maximum GPA -----
    function calculateMaxGPA() {
      if (!minCalculated) {
        document.getElementById("errorBox").textContent =
          "Please calculate your minimum GPA first.";
        document.getElementById("cgpaValue").textContent = "–";
        document.getElementById("totalCredits").textContent = "0";
        return;
      }

      const rows = document.querySelectorAll("#coursesBody tr");
      let totalCredits = 0, totalWeightedPoints = 0;
      let error = "";

      rows.forEach(row => {
        const subjName = row.cells[0].textContent.trim();
        const credits = parseFloat(row.dataset.credits);
        const maxMarks = parseFloat(row.dataset.maxMarks);
        const icaMax = parseFloat(row.dataset.icaMax);
        const limit = parseFloat(row.dataset.ifScoreMax);

        const icaVal = row.querySelector(".icaMarks").value;
        const ica = parseFloat(icaVal);

        if (icaVal === "" || isNaN(ica) || ica < 0 || ica > icaMax) {
          error = `Please enter valid ICA marks for ${subjName}.`;
          return;
        }

        let gp, totalMarks;
        const totalMarksSpan = row.querySelector(".totalMarks");
        const gradeSpan = row.querySelector(".grade");

        if (frozenSubjects.includes(subjName)) {
          if (row.dataset.minGp === undefined) {
            error = "Please calculate your minimum GPA first.";
            return;
          }
          const minGp = parseFloat(row.dataset.minGp);
          totalMarks = Math.min(ica, maxMarks);
          totalMarksSpan.textContent = totalMarks.toFixed(0);
          gradeSpan.textContent = gradeFromPoint(minGp);
          gp = minGp;
        } else {
          const ifScoreVal = row.querySelector(".ifScoreMarks").value;
          const score = parseFloat(ifScoreVal);

          if (ifScoreVal === "") {
            error = "";
            return;
          }

          if (isNaN(score) || score < 0 || score > limit) {
            error = `'If I score' for ${subjName} must be between 0 and ${limit}.`;
            return;
          }

          totalMarks = Math.min(ica + score, maxMarks);
          totalMarksSpan.textContent = totalMarks.toFixed(0);
          gp = getGradePoint(totalMarks, maxMarks);
          gradeSpan.textContent = gradeFromPoint(gp);
        }

        totalCredits += credits;
        totalWeightedPoints += credits * gp;
      });

      const errorBox = document.getElementById("errorBox");
      const cgpaValue = document.getElementById("cgpaValue");
      const totalCreditsSpan = document.getElementById("totalCredits");

      const anyEmptyIfScore = Array.from(rows).some(row => {
        const subjName = row.cells[0].textContent.trim();
        const ifScoreInput = row.querySelector(".ifScoreMarks");
        if (frozenSubjects.includes(subjName)) return false;
        return ifScoreInput.value === "";
      });

      if (error) {
        errorBox.textContent = error;
        cgpaValue.textContent = "–";
        totalCreditsSpan.textContent = "0";
        return;
      }

      if (anyEmptyIfScore || totalCredits === 0) {
        errorBox.textContent = "";
        cgpaValue.textContent = "–";
        totalCreditsSpan.textContent = "0";
        return;
      }

      errorBox.textContent = "";
      cgpaValue.textContent = (totalWeightedPoints / totalCredits).toFixed(2);
      totalCreditsSpan.textContent = totalCredits.toFixed(1);
    }

    // ----- Button handlers -----
    function handleMinClick() {
      switchToMinMode();
      calculateMinGPA();
      if (!document.getElementById("errorBox").textContent) {
        document.getElementById("maxBtn").style.display = "inline-flex";
      }
    }

    function handleMaxClick() {
      if (!minCalculated) {
        document.getElementById("errorBox").textContent =
          "Please calculate your minimum GPA first.";
        return;
      }
      switchToMaxMode();
      calculateMaxGPA();
    }

    // Global reset
    function clearFields() {
      const rows = document.querySelectorAll("#coursesBody tr");
      rows.forEach(row => {
        const subjName = row.cells[0].textContent.trim();
        const icaInput = row.querySelector(".icaMarks");
        const adjustedSpan = row.querySelector(".adjustedMarks");
        const ifScoreInput = row.querySelector(".ifScoreMarks");
        const totalMarksSpan = row.querySelector(".totalMarks");
        const totalCell = row.querySelector(".totalMarksCell");
        const gradeSpan = row.querySelector(".grade");

        icaInput.value = "";
        icaInput.disabled = false;

        adjustedSpan.textContent = "–";
        adjustedSpan.style.display = "inline";

        ifScoreInput.value = "";
        ifScoreInput.style.display = "none";
        ifScoreInput.disabled = false;
        const limit = row.dataset.ifScoreMax;
        ifScoreInput.placeholder = `0-${limit}`;
        if (frozenSubjects.includes(subjName)) {
          ifScoreInput.placeholder = "0-0";
        }

        totalMarksSpan.textContent = "–";
        totalCell.style.display = "none";

        gradeSpan.textContent = "–";
        delete row.dataset.minGp;
      });

      currentMode = "min";
      minCalculated = false;

      document.getElementById("cgpaValue").textContent = "–";
      document.getElementById("totalCredits").textContent = "0";
      document.getElementById("errorBox").textContent = "";
      document.getElementById("maxBtn").style.display = "none";
      document.getElementById("maxClearBtn").style.display = "none";
      document.getElementById("gpaLabel").textContent = "Your Minimum GPA:";
      document.getElementById("marksHeader").innerHTML =
        `Adjusted Marks<br><span style="font-weight:400;font-size:0.8rem;">(ICA + Pass Marks)</span>`;
      document.getElementById("totalHeader").style.display = "none";
    }

    // Max-only reset
    function clearMaxFields() {
      const rows = document.querySelectorAll("#coursesBody tr");
      rows.forEach(row => {
        const subjName = row.cells[0].textContent.trim();
        const ifScoreInput = row.querySelector(".ifScoreMarks");
        const totalMarksSpan = row.querySelector(".totalMarks");
        const gradeSpan = row.querySelector(".grade");

        ifScoreInput.value = "";
        totalMarksSpan.textContent = "–";
        if (!frozenSubjects.includes(subjName)) {
          gradeSpan.textContent = "–";
        }
      });

      document.getElementById("cgpaValue").textContent = "–";
      document.getElementById("totalCredits").textContent = "0";
      document.getElementById("errorBox").textContent = "";
    }

    window.addEventListener("DOMContentLoaded", createRows);
  </script>
</body>
</html>
